<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Logístico</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    margin: 0;
    padding: 20px;
}

.container {
    max-width: 900px;
    margin: auto;
}

h1, h2 {
    text-align: center;
}

/* INPUTS E BOTÕES */
input, button {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border-radius: 6px;
    border: none;
    font-size: 14px;
}

input {
    background: #1e293b;
    color: #fff;
}

button {
    background: #22c55e;
    color: #000;
    cursor: pointer;
    font-weight: bold;
}

#happyHourBtn {
    background: transparent;
    color: #64748b;
    font-size: 12px;
    padding: 4px 8px;
    border: 1px solid #334155;
    border-radius: 6px;
    cursor: pointer;
    width: auto;
}

button:hover {
    background: #16a34a;
}

.delete {
    background: #ef4444;
    color: #fff;
}

.delete:hover {
    background: #dc2626;
}

.hidden {
    display: none;
}

/* HEADER */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

/* LOGIN */
#loginBox {
    max-width: 400px;
    margin: 80px auto;
    text-align: center;
}

#loginError {
    color: #f87171;
}

/* LISTA */
ul {
    list-style: none;
    padding: 0;
}

li {
    background: #020617;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 10px;
}

.actions {
    margin-top: 8px;
    display: flex;
    gap: 8px;
}

/* LABELS */
.label {
    padding: 6px 10px;
    border-radius: 6px;
    font-weight: bold;
    margin-bottom: 8px;
    text-align: center;
}

.green {
    background: #22c55e;
    color: #000;
}

.yellow {
    background: #fde047;
    color: #000;
}

.orange {
    background: #f97316;
    color: #000;
}

.red {
    background: #ef4444;
    color: #fff;
}

.gray {
    background: #64748b;
    color: #fff;
}
</style>
</head>

<body>

<div class="container">

<!-- LOGIN -->
<div id="loginBox">
    <h1>Controle Logístico</h1>
    <input type="email" id="email" placeholder="Login">
    <input type="password" id="password" placeholder="Senha">
    <button id="loginBtn">Entrar</button>
    <p id="loginError"></p>
</div>

<!-- SISTEMA -->
<div id="system" class="hidden">

    <div class="header">
        <h1>Controle Logístico</h1>
        <button id="happyHourBtn">Happy Hour</button>
    </div>

    <form id="form">
        <input type="text" id="product" placeholder="Nome da mercadoria" required>
        <input type="text" id="courier" placeholder="Nome do entregador" required>

        <label>Início da entrega</label>
        <input type="datetime-local" id="start" required>

        <label>Previsão de término</label>
        <input type="datetime-local" id="expected" required>

        <label>Entrega confirmada</label>
        <input type="datetime-local" id="confirmed">

        <button type="submit">Salvar</button>
    </form>

    <h2>Entregas registradas</h2>
    <ul id="list"></ul>
</div>

</div>

<script>
/* ======================
   LOGIN FIXO
====================== */
const ADMIN_EMAIL = "admin@logistica.com";
const ADMIN_PASSWORD = "1234";

const loginBox = document.getElementById("loginBox");
const system = document.getElementById("system");
const loginBtn = document.getElementById("loginBtn");
const loginError = document.getElementById("loginError");
const happyHourBtn = document.getElementById("happyHourBtn");

loginBtn.onclick = () => {
    if (
        email.value.trim() === ADMIN_EMAIL &&
        password.value === ADMIN_PASSWORD
    ) {
        sessionStorage.setItem("logisticaLogin", "true");
        showSystem();
    } else {
        loginError.textContent = "Login ou senha inválidos";
    }
};

if (sessionStorage.getItem("logisticaLogin") === "true") {
    showSystem();
}

function showSystem() {
    loginBox.classList.add("hidden");
    system.classList.remove("hidden");
}

/* ======================
   HAPPY HOUR
====================== */
happyHourBtn.onclick = () => {
    window.location.href = "happyhour/index.html";
};

/* ======================
   DADOS
====================== */
let data = JSON.parse(sessionStorage.getItem("logisticaData")) || [];
const list = document.getElementById("list");
const form = document.getElementById("form");

/* ======================
   RENDER
====================== */
function render() {
    list.innerHTML = "";
    if (data.length === 0) {
        list.innerHTML = "<li>Nenhum registro cadastrado.</li>";
        return;
    }

    const now = new Date();

    data.forEach((item, index) => {
        const expected = new Date(item.expected);
        const confirmed = item.confirmed ? new Date(item.confirmed) : null;

        let labelText = "";
        let labelClass = "";
        let allowEdit = true;

        if (confirmed) {
            labelText = `Entregue em ${confirmed.toLocaleDateString()} às ${confirmed.toLocaleTimeString().slice(0,5)}`;
            labelClass = "green";
            allowEdit = false;
        } else {
            const diffMs = expected - now;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));

            if (diffMs < 0) {
                labelText = "Entrega atrasada";
                labelClass = "red";
            } else if (diffHours <= 1) {
                labelText = "Entrega iminente (menos de 1 hora)";
                labelClass = "orange";
            } else {
                labelText = `Faltam ${diffHours} hora(s)`;
                labelClass = "yellow";
            }
        }

        const li = document.createElement("li");
        li.innerHTML = `
            <div class="label ${labelClass}">${labelText}</div>
            <strong>Mercadoria:</strong> ${item.product}<br>
            <strong>Entregador:</strong> ${item.courier}<br>
            <strong>Início:</strong> ${item.start}<br>
            <strong>Previsão:</strong> ${item.expected}<br>
            <strong>Confirmada:</strong> ${item.confirmed || "-"}
            <div class="actions">
                ${allowEdit ? `<button onclick="editItem(${index})">Editar</button>` : ""}
                ${allowEdit ? `<button class="delete" onclick="removeItem(${index})">Excluir</button>` : ""}
            </div>
        `;
        list.appendChild(li);
    });
}

/* ======================
   CRUD
====================== */
form.onsubmit = e => {
    e.preventDefault();

    data.push({
        product: product.value,
        courier: courier.value,
        start: start.value,
        expected: expected.value,
        confirmed: confirmed.value
    });

    save();
    form.reset();
};

function editItem(index) {
    const i = data[index];
    if (i.confirmed) return;

    product.value = i.product;
    courier.value = i.courier;
    start.value = i.start;
    expected.value = i.expected;
    confirmed.value = i.confirmed;

    data.splice(index, 1);
    save();
}

function removeItem(index) {
    if (data[index].confirmed) return;
    if (confirm("Excluir este registro?")) {
        data.splice(index, 1);
        save();
    }
}

function save() {
    sessionStorage.setItem("logisticaData", JSON.stringify(data));
    render();
}

render();
</script>

</body>
</html>
